!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){e.exports=window.React},function(e,t,n){e.exports=n(3)()},function(e,t){e.exports=window.reactR},function(e,t,n){"use strict";var r=n(4);function a(){}function o(){}o.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,o,i){if(i!==r){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:a};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(1),i=n.n(o);function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var s=Object.freeze({START:"start",PAUSE:"pause",STOP:"stop",NONE:"none"}),u=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).init=function(){try{return n.leftchannel=[],n.rightchannel=[],n.recorder=null,n.recording=!1,n.recordingLength=0,n.volume=null,n.audioInput=null,n.sampleRate=null,n.AudioContext=window.AudioContext||window.webkitAudioContext,n.context=null,n.analyser=null,n.freeze=!1,n.canvas=n.canvasRef.current,n.canvasCtx=n.canvas.getContext("2d"),n.stream=null,n.tested=!1,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,Promise.resolve()}catch(e){return Promise.reject(e)}},n.getStream=function(e){return e||(e={audio:!0,video:!1}),navigator.mediaDevices.getUserMedia(e)},n.setUpRecording=function(){n.context=new n.AudioContext,n.sampleRate=n.context.sampleRate,n.volume=n.context.createGain(),n.audioInput=n.context.createMediaStreamSource(n.stream),n.analyser=n.context.createAnalyser(),n.audioInput.connect(n.analyser);n.recorder=n.context.createScriptProcessor(2048,2,2),n.analyser.connect(n.recorder),n.recorder.connect(n.context.destination);var e=c(n);n.recorder.onaudioprocess=function(t){if(e.recording){var n=t.inputBuffer.getChannelData(0),r=t.inputBuffer.getChannelData(1);e.tested||(e.tested=!0,n.reduce((function(e,t){return e+t}))||(console.log("Error: There seems to be an issue with your Mic"),e.stop(),e.stream.getTracks().forEach((function(e){e.stop()})),e.context.close())),e.leftchannel.push(new Float32Array(n)),e.rightchannel.push(new Float32Array(r)),e.recordingLength+=2048}},n.visualize()},n.mergeBuffers=function(e,t){for(var n=new Float32Array(t),r=0,a=e.length,o=0;o<a;o++){var i=e[o];n.set(i,r),r+=i.length}return n},n.interleave=function(e,t){for(var n=e.length+t.length,r=new Float32Array(n),a=0,o=0;o<n;)r[o++]=e[a],r[o++]=t[a],a++;return r},n.writeUTFBytes=function(e,t,n){for(var r=n.length,a=0;a<r;a++)e.setUint8(t+a,n.charCodeAt(a))},n.visualize=function(){if(n.WIDTH=n.canvas.width,n.HEIGHT=n.canvas.height,n.CENTERX=n.canvas.width/2,n.CENTERY=n.canvas.height/2,!n.analyser)return null;n.analyser.fftSize=4096;var e=new Uint8Array(n.analyser.frequencyBinCount),t=new Uint8Array(n.analyser.frequencyBinCount),r=t.length,a=n.HEIGHT/r,o=n.WIDTH-1;n.canvasCtx.clearRect(0,0,n.WIDTH,n.HEIGHT);var i=c(n);i.analyser.getByteTimeDomainData(e),i.canvasCtx.fillStyle="hsl(270, 31%, 14%)",i.canvasCtx.fillRect(0,0,i.WIDTH=window.innerWidth,i.HEIGHT=window.innerHeight);!function e(){if(i.freeze||cancelAnimationFrame(i.drawVisual),i.drawVisual=requestAnimationFrame(e),!i.freeze){var n=i.canvasCtx.getImageData(1,0,i.WIDTH=window.innerWidth-1,i.HEIGHT=window.innerHeight);i.canvasCtx.fillRect(0,0,i.WIDTH=window.innerWidth-1,i.HEIGHT=window.innerHeight),i.canvasCtx.putImageData(n,0,0),i.analyser.getByteFrequencyData(t);for(var c=0;c<r;c++){var s=t[c]/255,u=Math.round(120*s+280),l=10+70*s+"%";i.canvasCtx.beginPath(),i.canvasCtx.strokeStyle="hsl("+u+", 100%, "+l+")",i.canvasCtx.moveTo(o,i.canvas.height-c*a),i.canvasCtx.lineTo(o,i.canvas.height-(c*a+a)),i.canvasCtx.stroke()}}}()},n.setupMic=function(){try{var e=function(){n.setUpRecording()},t=function(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}((function(){return Promise.resolve(n.getStream()).then((function(e){window.stream=n.stream=e}))}),(function(e){console.log("Error: Issue getting mic",e)}));return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}},n.start=function(){try{return Promise.resolve(n.setupMic()).then((function(){n.recording=!0,n.freeze=!1,n.leftchannel.length=n.rightchannel.length=0,n.recordingLength=0}))}catch(e){return Promise.reject(e)}},n.stop=function(){var e=n.props,t=e.onStop,r=e.type;n.recording=!1,n.freeze=!0,n.closeMic(),n.leftBuffer=n.mergeBuffers(n.leftchannel,n.recordingLength),n.rightBuffer=n.mergeBuffers(n.rightchannel,n.recordingLength);var a=n.interleave(n.leftBuffer,n.rightBuffer),o=new ArrayBuffer(44+2*a.length),i=new DataView(o);n.writeUTFBytes(i,0,"RIFF"),i.setUint32(4,44+2*a.length,!0),n.writeUTFBytes(i,8,"WAVE"),n.writeUTFBytes(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,2,!0),i.setUint32(24,n.sampleRate,!0),i.setUint32(28,4*n.sampleRate,!0),i.setUint16(32,4,!0),i.setUint16(34,16,!0),n.writeUTFBytes(i,36,"data"),i.setUint32(40,2*a.length,!0);for(var c=a.length,s=44,u=0;u<c;u++)i.setInt16(s,32767*a[u],!0),s+=2;var l=new Blob([i],{type:r}),f=URL.createObjectURL(l);t&&t({blob:l,url:f,type:r}),n.analyser=null},n.pause=function(){n.recording=!1,n.closeMic()},n.resume=function(){n.setupMic(),n.recording=!0},n.closeMic=function(){n.stream.getAudioTracks().forEach((function(e){e.stop()})),n.audioInput.disconnect(0),n.analyser.disconnect(0),n.recorder.disconnect(0)},n.canvasRef=a.a.createRef(),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var o=r.prototype;return o.componentDidMount=function(){this.init()},o.componentDidUpdate=function(e,t){var n=this.props.state;this.checkState(e.state,n)},o.checkState=function(e){switch(e){case s.START:this.doIfState(s.PAUSE,this.pause),this.doIfState(s.STOP,this.stop);break;case s.PAUSE:this.doIfState(s.START,this.resume),this.doIfState(s.STOP,this.stop);break;case s.STOP:default:this.doIfState(s.START,this.start)}},o.doIfState=function(e,t){this.props.state==e&&t&&t()},o.componentWillUnmount=function(){},o.render=function(){var e=this.props,t=e.canvasWidth,n=e.canvasHeight;return a.a.createElement("div",{className:"audio-react-recorder"},a.a.createElement("canvas",{id:"spectogram",ref:this.canvasRef,width:t,height:n,className:"audio-react-recorder__canvas"}))},r}(a.a.Component);u.propTypes={state:i.a.string,type:i.a.string.isRequired,backgroundColor:i.a.string,foregroundColor:i.a.string,canvasWidth:i.a.oneOfType([i.a.string,i.a.number]),canvasHeight:i.a.oneOfType([i.a.string,i.a.number]),onStop:i.a.func},u.defaultProps={state:s.NONE,type:"audio/wav",backgroundColor:"hsl(280, 100%, 10%)",foregroundColor:"rgb(0, 0, 0)",canvasWidth:window.innerWidth,canvasHeight:400};var l=u,f=n(2);function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h=function(){var e=d(Object(r.useState)(s.NONE),2),t=e[0],n=e[1],o=d(Object(r.useState)(null),2),i=o[0],c=o[1];return a.a.createElement("div",null,a.a.createElement(l,{state:t,onStop:function(e){console.log("audioData",e),console.log("Url",e.url),c(e.url)}}),a.a.createElement("button",{onClick:function(e){n(s.START),console.log("start"),console.log(e.url)}},"Start"),a.a.createElement("button",{onClick:function(){n(s.STOP),console.log("stop")}},"Stop"),a.a.createElement("audio",{src:i,controls:"controls"}))};Object(f.reactWidget)("AudioReactRecorder","output",{AudioReactRecorderCustom:h})}]);
//# sourceMappingURL=AudioReactRecorder.js.map